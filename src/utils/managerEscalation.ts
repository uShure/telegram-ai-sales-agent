/**
 * –ú–æ–¥—É–ª—å —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É
 * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å –∂–∏–≤–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
 */

// Telegram username –º–µ–Ω–µ–¥–∂–µ—Ä–∞
const MANAGER_TELEGRAM = '@natalylini';
const MANAGER_CHAT_ID = ''; // –ù—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∏—Ç—å chat_id –º–µ–Ω–µ–¥–∂–µ—Ä–∞

// –ö–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã, —Ç—Ä–µ–±—É—é—â–∏–µ —ç—Å–∫–∞–ª–∞—Ü–∏–∏
const ESCALATION_TRIGGERS = {
  // –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
  order: [
    '–æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',
    '–∫—É–ø–∏—Ç—å –∫—É—Ä—Å',
    '—Ö–æ—á—É –æ–ø–ª–∞—Ç–∏—Ç—å',
    '–≥–æ—Ç–æ–≤ –æ–ø–ª–∞—Ç–∏—Ç—å',
    '–≥–æ—Ç–æ–≤–∞ –æ–ø–ª–∞—Ç–∏—Ç—å',
    '–∫–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å',
    '–æ–ø–ª–∞—Ç–∞ –∫—É—Ä—Å–∞',
    '–ø–æ–∫—É–ø–∞—é',
    '–±–µ—Ä—É –∫—É—Ä—Å',
    '–∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫—É—Ä—Å'
  ],

  // –õ–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è
  waitlist: [
    '–ª–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è',
    '–∑–∞–ø–∏—Å—å –Ω–∞ –±—É–¥—É—â–µ–µ',
    '–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –∫—É—Ä—Å',
    '—Å–ª–µ–¥—É—é—â–∏–π –ø–æ—Ç–æ–∫',
    '–∑–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω—è',
    '–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ',
    '—Ä–µ–∑–µ—Ä–≤ –º–µ—Å—Ç–∞'
  ],

  // –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º
  access: [
    '–Ω–µ –º–æ–≥—É –∑–∞–π—Ç–∏',
    '–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç',
    '–∑–∞–±—ã–ª –ø–∞—Ä–æ–ª—å',
    '–Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–∏—Å—å–º–æ',
    '–ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–æ—Å—Ç—É–ø–æ–º',
    '–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è',
    '–æ—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞',
    '–Ω–µ –ø—É—Å–∫–∞–µ—Ç'
  ],

  // –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞
  program: [
    '–ø—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞',
    '–ø–æ–¥—Ä–æ–±–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞',
    '—á—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –∫—É—Ä—Å',
    '–ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è',
    '—É—á–µ–±–Ω—ã–π –ø–ª–∞–Ω',
    '—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π',
    '–¥–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞'
  ],

  // –†–∞—Å—Å—Ä–æ—á–∫–∞
  installment: [
    '—Ä–∞—Å—Å—Ä–æ—á–∫–∞',
    '–æ–ø–ª–∞—Ç–∞ —á–∞—Å—Ç—è–º–∏',
    '–º–æ–∂–Ω–æ –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É',
    '–ø–ª–∞—Ç–µ–∂ —á–∞—Å—Ç—è–º–∏',
    '—Ä–∞–∑–¥–µ–ª–∏—Ç—å –æ–ø–ª–∞—Ç—É',
    '–∫—Ä–µ–¥–∏—Ç',
    '–æ—Ç—Å—Ä–æ—á–∫–∞ –ø–ª–∞—Ç–µ–∂–∞'
  ],

  // –û–ø–ª–∞—Ç–∞ –∫–∞–∫ –ò–ü/—é—Ä–ª–∏—Ü–æ
  business: [
    '–æ–ø–ª–∞—Ç–∏—Ç—å –∫–∞–∫ –∏–ø',
    '–æ–ø–ª–∞—Ç–∞ –æ—Ç –∏–ø',
    '–æ–ø–ª–∞—Ç–∞ –æ—Ç –æ–æ–æ',
    '—é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ',
    '–±–µ–∑–Ω–∞–ª–∏—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞',
    '–Ω—É–∂–µ–Ω –¥–æ–≥–æ–≤–æ—Ä',
    '—Å—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É',
    '—Å—á–µ—Ç –¥–ª—è –∏–ø',
    '—Å—á–µ—Ç –¥–ª—è –æ–æ–æ',
    '–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä'
  ],

  // –°—Ä–æ—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
  urgent: [
    '—Å—Ä–æ—á–Ω–æ',
    '–æ—á–µ–Ω—å –≤–∞–∂–Ω–æ',
    '–Ω—É–∂–µ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä',
    '–ø–æ–∑–æ–≤–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞',
    '—Ö–æ—á—É –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å —á–µ–ª–æ–≤–µ–∫–æ–º',
    '–∂–∏–≤–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä',
    '—Å–≤—è–∂–∏—Ç–µ —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º'
  ]
};

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ —ç—Å–∫–∞–ª–∞—Ü–∏—è –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É
 */
export function checkIfNeedsManager(message: string): {
  needsManager: boolean;
  reason: string;
  category: string;
} {
  const lowerMessage = message.toLowerCase();

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
  for (const [category, triggers] of Object.entries(ESCALATION_TRIGGERS)) {
    for (const trigger of triggers) {
      if (lowerMessage.includes(trigger)) {
        return {
          needsManager: true,
          reason: getReasonText(category),
          category
        };
      }
    }
  }

  return {
    needsManager: false,
    reason: '',
    category: ''
  };
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø—Ä–∏—á–∏–Ω—ã —ç—Å–∫–∞–ª–∞—Ü–∏–∏
 */
function getReasonText(category: string): string {
  const reasons = {
    order: 'üõí –ö–ª–∏–µ–Ω—Ç –≥–æ—Ç–æ–≤ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',
    waitlist: 'üìù –ó–∞–ø–∏—Å—å –≤ –ª–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è',
    access: 'üîê –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É',
    program: 'üìã –ó–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –∫—É—Ä—Å–∞',
    installment: 'üí≥ –í–æ–ø—Ä–æ—Å –æ —Ä–∞—Å—Å—Ä–æ—á–∫–µ',
    business: 'üè¢ –û–ø–ª–∞—Ç–∞ –æ—Ç –ò–ü/—é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞',
    urgent: 'üö® –°—Ä–æ—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å'
  };

  return reasons[category] || '‚ùì –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–º–æ—â—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞';
}

/**
 * –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞
 */
export function formatManagerNotification(
  clientName: string,
  clientId: string,
  clientMessage: string,
  reason: string,
  category: string
): string {
  const emoji = getCategoryEmoji(category);

  return `${emoji} *–¢–†–ï–ë–£–ï–¢–°–Ø –ü–û–ú–û–©–¨ –ú–ï–ù–ï–î–ñ–ï–†–ê*

*–ü—Ä–∏—á–∏–Ω–∞:* ${reason}
*–ö–ª–∏–µ–Ω—Ç:* ${clientName}
*ID:* \`${clientId}\`

*–°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞:*
"${clientMessage}"

*–î–µ–π—Å—Ç–≤–∏–µ:* –°–≤—è–∂–∏—Ç–µ—Å—å —Å –∫–ª–∏–µ–Ω—Ç–æ–º –≤ Telegram

‚è∞ –í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}

#—ç—Å–∫–∞–ª–∞—Ü–∏—è #${category}`;
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç —ç–º–æ–¥–∑–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
 */
function getCategoryEmoji(category: string): string {
  const emojis = {
    order: 'üõí',
    waitlist: 'üìù',
    access: 'üîê',
    program: 'üìã',
    installment: 'üí≥',
    business: 'üè¢',
    urgent: 'üö®'
  };

  return emojis[category] || '‚ùì';
}

/**
 * –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∏ —ç—Å–∫–∞–ª–∞—Ü–∏–∏
 */
export function getClientEscalationResponse(category: string): string {
  const responses = {
    order: `–û—Ç–ª–∏—á–Ω–æ! –Ø –≤–∏–∂—É, —á—Ç–æ –≤—ã –≥–æ—Ç–æ–≤—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑! üéâ

–Ø —É–∂–µ –ø–µ—Ä–µ–¥–∞–ª–∞ –≤–∞—à—É –∑–∞—è–≤–∫—É –º–µ–Ω–µ–¥–∂–µ—Ä—É –ù–∞—Ç–∞–ª—å–µ (${MANAGER_TELEGRAM}). –û–Ω–∞ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∏ –æ—Ç–≤–µ—Ç–∏—Ç –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã.

–û–±—ã—á–Ω–æ –º–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 15-30 –º–∏–Ω—É—Ç –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è.

–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Å—Ä–æ—á–Ω—ã–π, –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –ù–∞—Ç–∞–ª—å–µ –Ω–∞–ø—Ä—è–º—É—é: ${MANAGER_TELEGRAM}`,

    waitlist: `–ü–æ–Ω–∏–º–∞—é, –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –ª–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è! üìù

–Ø –ø–µ—Ä–µ–¥–∞–ª–∞ –≤–∞—à—É –∑–∞—è–≤–∫—É –º–µ–Ω–µ–¥–∂–µ—Ä—É –ù–∞—Ç–∞–ª—å–µ (${MANAGER_TELEGRAM}). –û–Ω–∞ –≤–Ω–µ—Å–µ—Ç –≤–∞—Å –≤ —Å–ø–∏—Å–æ–∫ –∏ —Å–æ–æ–±—â–∏—Ç –æ –±–ª–∏–∂–∞–π—à–∏—Ö –¥–∞—Ç–∞—Ö –∫—É—Ä—Å–∞.

–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.`,

    access: `–í–∏–∂—É, —É –≤–∞—Å –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–æ—Å—Ç—É–ø–æ–º üîê

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–º–æ—â–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞. –Ø —É–∂–µ —É–≤–µ–¥–æ–º–∏–ª–∞ –ù–∞—Ç–∞–ª—å—é (${MANAGER_TELEGRAM}) –æ –≤–∞—à–µ–π –ø—Ä–æ–±–ª–µ–º–µ.

–û–Ω–∞ –ø–æ–º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –≤ –∫—Ä–∞—Ç—á–∞–π—à–∏–µ —Å—Ä–æ–∫–∏. –û–±—ã—á–Ω–æ —Ç–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã —Ä–µ—à–∞—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç.`,

    program: `–í–∞–º –Ω—É–∂–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞ üìã

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –Ø –ø–µ—Ä–µ–¥–∞–ª–∞ –≤–∞—à –∑–∞–ø—Ä–æ—Å –º–µ–Ω–µ–¥–∂–µ—Ä—É –ù–∞—Ç–∞–ª—å–µ (${MANAGER_TELEGRAM}). –û–Ω–∞ –≤—ã—à–ª–µ—Ç –≤–∞–º –¥–µ—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ –≤—Å–µ–º–∏ –º–æ–¥—É–ª—è–º–∏.

–û–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!`,

    installment: `–ü–æ–Ω–∏–º–∞—é, –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —Ä–∞—Å—Å—Ä–æ—á–∫–∞ üí≥

–£ –Ω–∞—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ–ø–ª–∞—Ç—ã —á–∞—Å—Ç—è–º–∏! –Ø —É–∂–µ –ø–µ—Ä–µ–¥–∞–ª–∞ –≤–∞—à –∑–∞–ø—Ä–æ—Å –º–µ–Ω–µ–¥–∂–µ—Ä—É –ù–∞—Ç–∞–ª—å–µ (${MANAGER_TELEGRAM}).

–û–Ω–∞ —Ä–∞—Å—Å–∫–∞–∂–µ—Ç –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö —Ä–∞—Å—Å—Ä–æ—á–∫–∏ –∏ –ø–æ–º–æ–∂–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å —É–¥–æ–±–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π.`,

    business: `–í–∞–º –Ω—É–∂–Ω–∞ –æ–ø–ª–∞—Ç–∞ –æ—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞ üè¢

–ö–æ–Ω–µ—á–Ω–æ, –º—ã —Ä–∞–±–æ—Ç–∞–µ–º —Å –ò–ü –∏ –û–û–û! –Ø –ø–µ—Ä–µ–¥–∞–ª–∞ –≤–∞—à –∑–∞–ø—Ä–æ—Å –º–µ–Ω–µ–¥–∂–µ—Ä—É –ù–∞—Ç–∞–ª—å–µ (${MANAGER_TELEGRAM}).

–û–Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã: –¥–æ–≥–æ–≤–æ—Ä, —Å—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É, –∞–∫—Ç—ã. –û–±—ã—á–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—è—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞.`,

    urgent: `–ü–æ–Ω–∏–º–∞—é, –≤–∞—à –≤–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç —Å—Ä–æ—á–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è! üö®

–Ø –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —É–≤–µ–¥–æ–º–∏–ª–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ù–∞—Ç–∞–ª—å—é (${MANAGER_TELEGRAM}) –æ –≤–∞—à–µ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏.

–û–Ω–∞ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–∏–µ –º–∏–Ω—É—Ç—ã. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ —Å—Ä–æ—á–Ω—ã–π, –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –µ–π –Ω–∞–ø—Ä—è–º—É—é: ${MANAGER_TELEGRAM}`
  };

  return responses[category] || `–í–∞—à –≤–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç —É—á–∞—Å—Ç–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞.

–Ø —É–∂–µ –ø–µ—Ä–µ–¥–∞–ª–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ù–∞—Ç–∞–ª—å–µ (${MANAGER_TELEGRAM}). –û–Ω–∞ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.

–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Å—Ä–æ—á–Ω—ã–π, –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é: ${MANAGER_TELEGRAM}`;
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –±—ã–ª –ª–∏ –∫–ª–∏–µ–Ω—Ç —É–∂–µ —ç—Å–∫–∞–ª–∏—Ä–æ–≤–∞–Ω –Ω–µ–¥–∞–≤–Ω–æ
 */
export function wasRecentlyEscalated(
  clientId: string,
  escalationHistory: Map<string, Date>
): boolean {
  const lastEscalation = escalationHistory.get(clientId);
  if (!lastEscalation) return false;

  // –ù–µ —ç—Å–∫–∞–ª–∏—Ä–æ–≤–∞—Ç—å —á–∞—â–µ —á–µ–º —Ä–∞–∑ –≤ 30 –º–∏–Ω—É—Ç
  const thirtyMinutesAgo = new Date(Date.now() - 30 * 60 * 1000);
  return lastEscalation > thirtyMinutesAgo;
}

/**
 * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —ç—Å–∫–∞–ª–∞—Ü–∏–∏
 */
export function getEscalationPriority(category: string): 'high' | 'medium' | 'low' {
  const highPriority = ['order', 'urgent', 'access'];
  const mediumPriority = ['installment', 'business', 'waitlist'];

  if (highPriority.includes(category)) return 'high';
  if (mediumPriority.includes(category)) return 'medium';
  return 'low';
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è –¥–ª—è —ç—Å–∫–∞–ª–∞—Ü–∏–∏
 */
export function isWorkingHours(): boolean {
  const now = new Date();
  const moscowTime = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Moscow"}));
  const hour = moscowTime.getHours();
  const day = moscowTime.getDay();

  // –†–∞–±–æ—á–∏–µ —á–∞—Å—ã: –ø–Ω-–ø—Ç 9:00-19:00, —Å–± 10:00-16:00 –ø–æ –ú–æ—Å–∫–≤–µ
  if (day === 0) return false; // –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
  if (day === 6) return hour >= 10 && hour < 16; // –°—É–±–±–æ—Ç–∞
  return hour >= 9 && hour < 19; // –ë—É–¥–Ω–∏
}

/**
 * –§–æ—Ä–º–∏—Ä—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –Ω–µ—Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
 */
export function getNonWorkingHoursMessage(): string {
  return `\n\n‚è∞ *–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:* –°–µ–π—á–∞—Å –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è. –ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–≤–µ—Ç–∏—Ç –≤–∞–º –≤ –Ω–∞—á–∞–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è.

*–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã:*
–ü–Ω-–ü—Ç: 9:00-19:00
–°–±: 10:00-16:00
–í—Å: –≤—ã—Ö–æ–¥–Ω–æ–π
(–≤—Ä–µ–º—è –º–æ—Å–∫–æ–≤—Å–∫–æ–µ)`;
}
