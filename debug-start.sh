#!/bin/bash

echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º –∑–∞–ø—É—Å–∫–∞..."
echo "================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ bun
echo "1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ Bun..."
if command -v bun &> /dev/null; then
    echo "‚úÖ Bun —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: $(bun --version)"
else
    echo "‚ùå Bun –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    echo ""
    echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Bun –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:"
    echo "curl -fsSL https://bun.sh/install | bash"
    echo ""
    echo "–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ npm/yarn:"
    echo "npm install"
    echo "npm start"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ node
echo ""
echo "2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js..."
if command -v node &> /dev/null; then
    echo "‚úÖ Node.js —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: $(node --version)"
else
    echo "‚ö†Ô∏è  Node.js –Ω–µ –Ω–∞–π–¥–µ–Ω (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Bun)"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ .env
echo ""
echo "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ .env —Ñ–∞–π–ª–∞..."
if [ -f .env ]; then
    echo "‚úÖ –§–∞–π–ª .env –Ω–∞–π–¥–µ–Ω"
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    if grep -q "API_ID=" .env && grep -q "GROQ_API_KEY=" .env; then
        echo "‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
    else
        echo "‚ùå –í .env –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ"
    fi
else
    echo "‚ùå –§–∞–π–ª .env –ù–ï –Ω–∞–π–¥–µ–Ω!"
    echo "–°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo ""
echo "4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
if [ -d "node_modules" ]; then
    echo "‚úÖ –ü–∞–ø–∫–∞ node_modules —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
else
    echo "‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"
    echo "–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é..."
    bun install
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
echo ""
echo "5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞..."
if [ -f "src/index.ts" ]; then
    echo "‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ"
else
    echo "‚ùå –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç!"
fi

echo ""
echo "üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
echo "========================"
echo ""

# –ï—Å–ª–∏ –≤—Å–µ –æ–∫, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å
if command -v bun &> /dev/null && [ -f .env ] && [ -f "src/index.ts" ]; then
    echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!"
    echo ""
    read -p "üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞? (y/n): " -n 1 -r
    echo ""
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "–ó–∞–ø—É—Å–∫–∞—é..."
        bun run src/index.ts
    fi
else
    echo "‚ùå –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—ã –≤—ã—à–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞"
fi
